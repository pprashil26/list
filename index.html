<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collections v2 Minimal</title>
<style>
:root{
  --mint:#dff5ec;
  --brown:#3e2f25;
  --line:#c8e8dc;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;color:var(--brown);}
body{background:var(--mint);display:flex;flex-direction:column;height:100vh;overflow:hidden;font-size:16px;}

/* Header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:6px 8px;
  border-bottom:1px solid var(--line);
}

.header button{
  font-size:16px;
  background:none;
  border:none;
  cursor:pointer;
  margin-left:4px;
}

/* List titles bar */
#titlesBar{
  display:flex;
  overflow-x:auto;
  padding:4px 6px;
  border-bottom:1px solid var(--line);
  flex-wrap: nowrap;
}

.listTitle{
  display:flex;
  align-items:center;
  padding:4px 6px;
  margin-right:4px;
  background:rgba(255,255,255,0.1);
  border-radius:4px;
  cursor:pointer;
  font-size:14px;
}

.listTitle.selected{background:rgba(62,47,37,0.1);}

.listTitle span.titleText{margin-right:4px;}
.listTitle span.delete{font-size:14px;margin-left:4px;cursor:pointer;}
.listTitle select{font-size:14px;margin-left:2px;}

/* Editor textarea */
#editor{
  flex:1;
  border:none;
  outline:none;
  resize:none;
  padding:8px;
  font-family:monospace;
  font-size:16px;
  line-height:1.4;
  background:none;
}

/* Mobile adjustments */
@media(max-width:768px){
  body{font-size:14px;}
  .header button, .listTitle select{font-size:14px;}
  #editor{padding:6px; line-height:1.3;}
}
</style>
</head>
<body>

<div class="header">
  <div>
    <button onclick="addList()">+ Add List</button>
    <button onclick="toggleTitlesBar()">Show/Hide Titles</button>
  </div>
</div>

<div id="titlesBar"></div>

<textarea id="editor" placeholder="Select a list to start typing..."></textarea>

<script>
// Data storage
let lists = JSON.parse(localStorage.getItem("collections_v2")) || [];
let selectedListId = lists.length>0 ? lists[0].id : null;
let titlesVisible = true;

// Save to localStorage
function save(){ localStorage.setItem("collections_v2", JSON.stringify(lists)); }

// Toggle titles bar
function toggleTitlesBar(){
  titlesVisible=!titlesVisible;
  document.getElementById("titlesBar").style.display=titlesVisible?"flex":"none";
}

// Add new list
function addList(){
  const id=Date.now().toString();
  lists.push({id,title:"New List",bullet:"dot",content:""});
  selectedListId=id;
  save();
  render();
}

// Delete list
function deleteList(id){ 
  lists = lists.filter(l=>l.id!==id); 
  if(selectedListId===id) selectedListId=lists.length>0?lists[0].id:null;
  save();
  render();
}

// Render all
function render(){
  const titlesBar=document.getElementById("titlesBar");
  titlesBar.innerHTML="";
  lists.forEach(list=>{
    const titleDiv=document.createElement("div");
    titleDiv.className="listTitle"+(list.id===selectedListId?" selected":"");

    // Title editable
    const titleText=document.createElement("span");
    titleText.className="titleText";
    titleText.contentEditable=true;
    titleText.innerText=list.title;
    titleText.addEventListener("input",()=>{ list.title=titleText.innerText; save(); });

    // Bullet type
    const bulletSelect=document.createElement("select");
    ["dot","dash","number"].forEach(type=>{
      const opt=document.createElement("option"); opt.value=type; opt.innerText=type;
      if(list.bullet===type) opt.selected=true;
      bulletSelect.appendChild(opt);
    });
    bulletSelect.addEventListener("change",()=>{ list.bullet=bulletSelect.value; save(); });

    // Delete icon
    const deleteSpan=document.createElement("span");
    deleteSpan.className="delete"; deleteSpan.innerText="×";
    deleteSpan.onclick=(e)=>{ e.stopPropagation(); deleteList(list.id); };

    titleDiv.appendChild(titleText);
    titleDiv.appendChild(bulletSelect);
    titleDiv.appendChild(deleteSpan);

    // Click to select
    titleDiv.onclick=()=>{ selectedListId=list.id; renderEditor(); render(); };

    titlesBar.appendChild(titleDiv);
  });
  renderEditor();
}

// Render selected list in editor
function renderEditor(){
  const editor=document.getElementById("editor");
  const list=lists.find(l=>l.id===selectedListId);
  if(!list){ editor.value=""; editor.placeholder="No list selected."; return; }
  editor.value=list.content;
  editor.placeholder="";
}

// Editor input & auto-bullet
const editor=document.getElementById("editor");
editor.addEventListener("input",()=>{
  const list=lists.find(l=>l.id===selectedListId);
  if(list){ list.content=editor.value; save(); }
});

editor.addEventListener("keydown",(e)=>{
  if(e.key==="Enter"){
    const list=lists.find(l=>l.id===selectedListId);
    if(!list) return;
    const start=editor.selectionStart;
    const text=editor.value.substring(0,start);
    const lines=text.split("\n");
    const last=lines[lines.length-1];
    let prefix="";
    if(list.bullet==="dot") prefix="• ";
    else if(list.bullet==="dash") prefix="- ";
    else if(list.bullet==="number"){
      const match=last.match(/^(\d+)\./);
      prefix=(match?parseInt(match[1])+1:1)+". ";
    }
    setTimeout(()=>{
      const pos=editor.selectionStart;
      editor.value=editor.value.substring(0,pos)+prefix+editor.value.substring(pos);
      editor.selectionStart=editor.selectionEnd=pos+prefix.length;
      list.content=editor.value;
      save();
    },0);
  }
});

// Initialize
render();
</script>

</body>
</html>