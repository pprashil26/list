<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Collections v1</title>
<style>
:root{
  --mint:#dff5ec;
  --brown:#3e2f25;
  --line:#c8e8dc;
  --dot:#3e2f25;
}

/* Reset */
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;color:var(--brown);}
body{background:var(--mint);display:flex;flex-direction:column;height:100vh;overflow:hidden;font-size:16px;}

/* Header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:6px 8px;
  border-bottom:1px solid var(--line);
}

.header button{
  font-size:16px;
  background:none;
  border:none;
  cursor:pointer;
  margin-left:4px;
}

/* Lists container */
#listsContainer{
  flex:1;
  overflow-y:auto;
  padding:4px 8px;
}

/* Individual list panel */
.listPanel{
  border:1px solid var(--line);
  margin-bottom:6px;
  border-radius:4px;
  background:rgba(255,255,255,0.1);
}

.listHeader{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:4px 6px;
  font-weight:500;
  cursor:pointer;
}

.listHeader span.title{flex:1; min-width:0;}
.listHeader span.delete{margin-left:6px; font-size:14px; cursor:pointer;}
.listHeader select{margin-left:6px; font-size:14px;}

/* Editor textarea with dot grid */
.listEditor{
  width:100%;
  border:none;
  outline:none;
  resize:none;
  font-family:monospace;
  padding:6px;
  background-image:
    radial-gradient(var(--dot) 1px, transparent 1px);
  background-size:16px 16px;
  line-height:1.4;
  font-size:16px;
  min-height:80px;
}

/* Completed item */
.completed{ text-decoration: line-through; color: rgba(62,47,37,0.6); }

/* Compact spacing for mobile */
@media(max-width:768px){
  body{font-size:14px;}
  .header button, .listHeader select{font-size:14px;}
  .listEditor{padding:4px; line-height:1.3;}
}
</style>
</head>
<body>

<div class="header">
  <div>
    <button onclick="newList()">+ Add List</button>
    <button onclick="toggleAllLists()">Show/Hide All</button>
  </div>
</div>

<div id="listsContainer"></div>

<script>
let lists = JSON.parse(localStorage.getItem("collections_v1")) || [];
let allVisible = true;

// Save to localStorage
function save(){ localStorage.setItem("collections_v1", JSON.stringify(lists)); }

// Toggle all lists visibility
function toggleAllLists(){
  allVisible = !allVisible;
  renderLists();
}

// Create new list
function newList(){
  const id=Date.now().toString();
  lists.push({id,title:"New List",bullet:"dot",content:""});
  save();
  renderLists();
}

// Delete list
function deleteList(id){
  lists = lists.filter(l=>l.id!==id);
  save();
  renderLists();
}

// Render all lists
function renderLists(){
  const container=document.getElementById("listsContainer");
  container.innerHTML="";
  lists.forEach(list=>{
    const panel=document.createElement("div");
    panel.className="listPanel";

    // Header with title, delete icon, bullet type
    const header=document.createElement("div");
    header.className="listHeader";

    const titleSpan=document.createElement("span");
    titleSpan.className="title";
    titleSpan.contentEditable=true;
    titleSpan.innerText=list.title;
    titleSpan.addEventListener("input",()=>{ list.title=titleSpan.innerText; save(); });

    const bulletSelect=document.createElement("select");
    ["dot","dash","number"].forEach(type=>{
      const opt=document.createElement("option"); opt.value=type; opt.innerText=type;
      if(list.bullet===type) opt.selected=true;
      bulletSelect.appendChild(opt);
    });
    bulletSelect.addEventListener("change",()=>{ list.bullet=bulletSelect.value; save(); renderEditor(listEditor,list); });

    const deleteSpan=document.createElement("span");
    deleteSpan.className="delete";
    deleteSpan.innerText="×";
    deleteSpan.onclick=(e)=>{ e.stopPropagation(); deleteList(list.id); };

    header.appendChild(titleSpan);
    header.appendChild(bulletSelect);
    header.appendChild(deleteSpan);

    panel.appendChild(header);

    // Editor
    const listEditor=document.createElement("textarea");
    listEditor.className="listEditor";
    renderEditor(listEditor,list);

    // Auto bullet insertion
    listEditor.addEventListener("keydown",(e)=>{
      if(e.key==="Enter"){
        const start=listEditor.selectionStart;
        const text=listEditor.value.substring(0,start);
        const lines=text.split("\n");
        const last=lines[lines.length-1];
        let prefix="";
        if(list.bullet==="dot") prefix="• ";
        else if(list.bullet==="dash") prefix="- ";
        else if(list.bullet==="number"){
          const match=last.match(/^(\d+)\./);
          prefix=(match?parseInt(match[1])+1:1)+". ";
        }
        setTimeout(()=>{
          const pos=listEditor.selectionStart;
          listEditor.value=listEditor.value.substring(0,pos)+prefix+listEditor.value.substring(pos);
          listEditor.selectionStart=listEditor.selectionEnd=pos+prefix.length;
          list.content=listEditor.value;
          save();
        },0);
      }
    });

    // Update content on input
    listEditor.addEventListener("input",()=>{ list.content=listEditor.value; save(); });

    if(allVisible) panel.appendChild(listEditor);
    container.appendChild(panel);
  });
}

// Render content inside editor
function renderEditor(editor,list){
  editor.value=list.content;
}

// Initialize
renderLists();
</script>

</body>
</html>